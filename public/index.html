<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Snake Multiplayer</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; text-align:center; background:black; color:white; }
    #home { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
    input, button { font-size: 24px; padding: 10px 10px; margin:5px; }
    canvas { display:none; background:black; margin:auto; display:block; }
  </style>
</head>
<body>

<!-- Homescreen -->
<div id="home">
  <h1>Snake Multiplayer</h1>
  <input id="nameInput" type="text" placeholder="Enter your name" />
  <br>
  <button id="joinBtn">Join Game</button>
</div>

<!-- Spiel Canvas -->
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const CELL_SIZE = 20;

let playerId = 0;
let currentDir = 'RIGHT';
let snakes = [], food = {}, scores = [0,0];

const home = document.getElementById('home');
const joinBtn = document.getElementById('joinBtn');
const nameInput = document.getElementById('nameInput');

let socket = null;

// --- Homescreen Button ---
joinBtn.addEventListener('click', () => {
  const playerName = nameInput.value.trim();
  if(!playerName) return alert("Bitte gib einen Namen ein!");

  home.style.display = 'none';
  canvas.style.display = 'block';

  // Socket.IO Verbindung starten
  socket = io();

  // Name an Server senden
  socket.emit('joinGame', playerName);

  // Initialisierung
  socket.on('init', (data) => {
    if(data.playerId === -1){
      alert("Zu viele Spieler â€“ du bist nur Zuschauer!");
    } else {
      playerId = data.playerId;
      console.log(`Willkommen ${data.playerName}, deine ID: ${playerId}`);
    }
  });

  // Spielzustand empfangen
  socket.on('state', (data)=>{
    snakes = data.snakes;
    food = data.food;
    scores = data.scores;
    draw();
  });
});

// --- Tasteneingaben ---
document.addEventListener('keydown', e => {
  if(!socket || playerId === -1) return; // Zuschauer oder noch nicht gestartet
  let dir = null;
  if(e.key==='ArrowUp' && currentDir!=='DOWN') dir='UP';
  if(e.key==='ArrowDown' && currentDir!=='UP') dir='DOWN';
  if(e.key==='ArrowLeft' && currentDir!=='RIGHT') dir='LEFT';
  if(e.key==='ArrowRight' && currentDir!=='LEFT') dir='RIGHT';
  if(dir){
    currentDir = dir;
    socket.emit('direction', dir);
  }
});

// --- Zeichnen ---
function draw(){
  ctx.fillStyle='black';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const colors=['green','yellow'];
  snakes.forEach((snake,i)=>{
    ctx.fillStyle=colors[i % colors.length];
    snake.forEach(seg=>ctx.fillRect(seg.x, seg.y, CELL_SIZE, CELL_SIZE));
  });

  ctx.fillStyle='red';
  ctx.fillRect(food.x, food.y, CELL_SIZE, CELL_SIZE);

  ctx.fillStyle='white';
  ctx.font='30px Arial';
  ctx.fillText(`Player 1: ${scores[0]}`,10,30);
  ctx.fillText(`Player 2: ${scores[1]}`,10,70);
}
</script>

</body>
</html>
